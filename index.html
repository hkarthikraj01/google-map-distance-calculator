<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Map Distance Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">
  
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Poiret+One|Raleway" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.1.1/css/hover-min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="css/custom.css">
</head>
<body>
  
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
          aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Map Distance Calculator</a>
      </div>
  
      <!-- Collect the nav links, forms, and other content for toggling -->
    
    </div>
    <!-- /.container-fluid -->
  </nav>

  <div class="container-fluid raleway">
    <div class="row">
      <div class="col-md-12" style="padding: 0;">
        <div class="map-position">
          <div id="map"></div>
        </div>
      </div>
      <div class="col-sm-12">
        <section id="locations">
          <h3>Your Start And End Location</h3>
          <div class="title-strips-over dark"></div>
          <div class="form-group col-sm-12">
            <label>
              <i class="fa fa-play"></i> Start Location
            </label>
            <input placeholder="Eg. Okelewo, Abeokuta" id="start" type="search" class="form-control" required>
          </div>
          <div class="form-group col-sm-12">
            <label>
              <i class="fa fa-stop"></i> End Location</label>
            <input placeholder="Eg. Quarry, Abeokuta" id="end" type="search" class="form-control" required>
          </div>
          <div class="form-group">
            <button class="btn" onclick="calculate()" data-scroll>Calculate
              <i class="fa fa-check"></i>
            </button>
          </div>
        </section>
      
        
        <section id="results">
          <div id="warnings-panel"></div>
          
          <div id="total"></div>
        </section>
        
      </div>
    </div>
  </div>

  
  <!-- Compiled and minified JavaScript -->
  <script src="js/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNKpr4auBLgBgiOXJ41UUWTB58MZa6p3E&callback=initMap"
  type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/smooth-scroll/12.1.5/js/smooth-scroll.min.js"></script>
  <script src="js/custom.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>
  <script>
    /* Initialize Firebase
    var config = {
      apiKey: "AIzaSyCrTLW0K4xA7YPp5KyMGj51gtijCcn1bnM",
      authDomain: "traveller-eca7b.firebaseapp.com",
      databaseURL: "https://traveller-eca7b.firebaseio.com",
      projectId: "traveller-eca7",
      storageBucket: "",
      messagingSenderId: "553314801643"
    };
    firebase.initializeApp(config);*/
    	var markers = [];
		var locations = [];
		var map;
		var distanceDirection;
		var distanceDisplay;
		function string2Location(input, index) {
			var searchBox = new google.maps.places.SearchBox(input);
			// map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
			map.addListener('bounds_changed', function() {
				searchBox.setBounds(map.getBounds());
			});
			distanceDirection = new google.maps.DirectionsService();
			distanceDisplay = new google.maps.DirectionsRenderer();
			searchBox.addListener('places_changed', function() {
				var places = searchBox.getPlaces();
				if(places.length == 0) {
					return;
				}
				markers[index].setMap(null);
				var bounds = new google.maps.LatLngBounds();
				places.forEach(function(place) {
					if(!place.geometry) {
						console.log("Returned place contains no geometry");
						return;
					}
					var icon = {
						url: place.icon,
						size: new google.maps.Size(71, 71),
						origin: new google.maps.Point(0, 0),
						anchor: new google.maps.Point(17, 34),
						scaledSize: new google.maps.Size(25, 25)
					};
					markers[index]=new google.maps.Marker({
						map: map,
						icon: icon,
						title: place.name,
						position: place.geometry.location
					});
					if(index == 0) {
						locations[index]=place.geometry.location;
					}
					else {
						locations[index]=place.geometry.location;
					}
					// console.log(locations[index].lat() + ", " + locations[index].lng());
					if(place.geometry.viewport) {
						bounds.union(place.geometry.viewport);
					} else {
						bounds.extend(place.geometry.location);
					}
				});
				map.fitBounds(bounds);
				distanceDisplay.setMap(map);
			});
		}
		function initAutocomplete() {
			locations[0] = new google.maps.LatLng();
			locations[1] = new google.maps.LatLng();
			markers[0] = new google.maps.Marker();
			markers[1] = new google.maps.Marker();
			map = new google.maps.Map(document.getElementById('map'), {
				// Default position...
				center: {
					lat: 35.0823294,
					lng: -106.8165662
				},
				zoom: 13,
				// https://developers.google.com/maps/documentation/javascript/maptypes
				mapTypeId: 'roadmap', // https://developers.google.com/maps/documentation/gaming/support/roadmap
			});
			var from = document.getElementById('start');
			var to = document.getElementById('end');
			string2Location(from, 0);
			string2Location(to, 1);
			google.maps.event.addDomListener(document.getElementById('submit'), 'click', calcRoute);
		}
		function calcDistance(start, end) {
			return(google.maps.geometry.spherical.computeDistanceBetween(start, end) / 1000).toFixed(2); //KM
		}
		function calcRoute() {
			var value_distance=document.querySelector("#value-distance");
			var value_price=document.querySelector("#value-price");
			var start = new google.maps.LatLng(locations[0].lat(), locations[0].lng());
			var end = new google.maps.LatLng(locations[1].lat(), locations[1].lng());
			var distance=calcDistance(start, end);
			value_distance.innerHTML=distance;
			value_price.innerHTML="â‚¹"+(distance * 15); // We can use .toFixed()...
			var bounds = new google.maps.LatLngBounds();
			bounds.extend(start);
			bounds.extend(end);
			map.fitBounds(bounds);
			var request = {
				travelMode: google.maps.TravelMode.DRIVING,
				origin: start,
				destination: end,
			};
			distanceDirection.route(request, function(response, status) {
				if(status == google.maps.DirectionsStatus.OK) {
					distanceDisplay.setDirections(response);
					distanceDisplay.setMap(map);
				}
				else {
					alert("Error: From " + start.toUrlValue(6) + " to " + end.toUrlValue(6) + " failed : " + status);
				}
			});
		}
  </script>
</body>
</html>
